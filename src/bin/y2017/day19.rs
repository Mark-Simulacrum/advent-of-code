fn with_direction(v: usize, dir: isize) -> usize {
    assert!(dir.abs() == 1 || dir == 0);
    ((v as isize) + dir) as usize
}

#[derive(Copy, Clone, Debug)]
struct Direction {
    x: isize,
    y: isize,
}

impl Direction {
    fn reverse(self) -> Direction {
        Direction {
            x: -self.x,
            y: -self.y,
        }
    }
}

fn eval(s: &str) -> (String, usize) {
    let mut grid = s.trim_matches('\n')
        .lines()
        .map(|l| l.as_bytes().to_vec())
        .collect::<Vec<_>>();
    for row in &mut grid {
        row.insert(0, b' ');
        row.push(b' ');
    }
    let width = grid.iter().map(|x| x.len()).max().unwrap();
    grid.insert(0, vec![b' '; width]);
    grid.push(vec![b' '; width]);
    let mut y = 1;
    let mut x = grid[y].iter().position(|b| *b == b'|').unwrap();
    let mut dir = Direction { x: 0, y: 1 };
    let mut seen = String::new();
    let mut steps = 0;
    loop {
        assert!(dir.x != 0 || dir.y != 0, "at x={}, y={}", x, y);
        match grid[y][x] {
            b'|' | b'-' => {
                y = with_direction(y, dir.y);
                x = with_direction(x, dir.x);
            }
            b'+' => {
                let last_val =
                    grid[with_direction(y, dir.reverse().y)][with_direction(x, dir.reverse().x)];
                let check = if dir.x != 0 {
                    [
                        (with_direction(y, 1), x, Direction { x: 0, y: 1 }),
                        (with_direction(y, -1), x, Direction { x: 0, y: -1 }),
                    ]
                } else {
                    [
                        (y, with_direction(x, 1), Direction { x: 1, y: 0 }),
                        (y, with_direction(x, -1), Direction { x: -1, y: 0 }),
                    ]
                };
                let next = check
                    .iter()
                    .find(|p| {
                        let v = grid.get(p.0)
                            .and_then(|r| r.get(p.1).cloned())
                            .unwrap_or(b' ');
                        v != b' ' && v != last_val
                    })
                    .unwrap();
                y = next.0;
                x = next.1;
                dir = next.2;
            }
            b' ' => return (seen, steps),
            b => {
                if dir.x != 0 {
                    x = with_direction(x, dir.x);
                } else if dir.y != 0 {
                    y = with_direction(y, dir.y);
                }
                seen.push(b as char);
            }
        }
        steps += 1;
    }
}

pub fn part1(s: &str) -> String {
    eval(s).0
}

pub fn part2(s: &str) -> usize {
    eval(s).1
}

#[test]
fn part1_1() {
    assert_eq!(part1(EXAMPLE), "ABCDEF");
}

#[test]
fn part1_actual() {
    assert_eq!(part1(INPUT), "VTWBPYAQFU");
}

#[test]
fn part2_actual() {
    assert_eq!(part2(INPUT), 17358);
}

#[cfg(test)]
static EXAMPLE: &str = "
     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+
";

pub static INPUT: &str = "
                                                                                                                                                             |
 +-------------------------------+           +-------------+           +-+   +---------------------+     +-------+                       +-----------------------------------------+       +-----+
 |                               |           |             |           | |   |                     |     |       |                       |                   |                     |       |     |
 +-----+ +-----------------------------------|---+         |           | |   |     +---+           +-----|---------------+     +---------------+ +-----+ +---|---------------------|-------+ +---|-+ +-+
       | |                       |           |   |         |           | |   |     |   |                 |       |       |     |         |     | |     | |   |                     |         |   | | | |
       +-|---+ +-----------------|---------------|---+     | +---------|-|-+ | +---|---|---------------------+   +---+   |     |         |     +-|-----|-|---|-----------------+   +---------|-------|-+
         |   | |                 |           |   |   |     | |         | | | | |   |   |                 |   |       |   |     |         |       |     | |   |                 |             |   | | |
         |   | +-----------------|-------------------|-----|-|---------|-------|---+   |                 |   +-----------|-----|-----------+     |     | |   |             +---+           +-----|-|---+
         |   |                   |           |   |   |     | |         | | | | |       |                 |           |   |     |         | |     |     | |   |             |               | |   | | | |
         |   +-------------------|---------------|-----------|-----------|-+ | +-------------------------|---+     +-|---------|---------|-|-----|-----------|-----------------------------------|-|-+ |
         |                       |           |   |   |     | |         | |   |         |                 |   |     | |   |     |         | |     |     | |   |             |               | |   | |   |
   +-+   | +---+ +-----------------------------------|---------------------+ +---------------------------|-----------|---|-----------------------------------|-------+     |       +---------+   | |   |
   | |   | |   | |               |           |   |   |     | |         | | |           |                 |   |     | |   |     |         | |     |     | |   |       |     |       |       |     | |   |
   | |   +-----------------------------------|---------------|-------------|-----------|-----------+     |   |     | |   |     |     +---|-|-----|-----------+       |   +---------------------+ | |   |
   | |     |   | |               |           |   |   |     | |         | | |           |           |     |   |     | |   |     |     |   | |     |     | |           |   | |       |       |   | | |   |
   | |     |   | |               | +-----------------|-----------------|-|-|-----------|-----------|-----|---|-----|-|---+     |   +-|---|-------|-------|---+   +---|---|-+ +-----|-----------|---|-+ |
   | |     |   | |               | |         |   |   |     | |         | | |           |           |     |   |     | |         |   | |   | |     |     | |   |   |   |   |   |     |       |   | | | | |
   | | +---|---|---------------------------+ |   |   |     | | +---------|-|---+       |           |     |   |     | |         |   | |   +-+     |     | +---|---|------P|-+ |     |       |   | +-+ | |
   | | |   |   | |               | |       | |   |   |     | | |       | | |   |       |           |     |   |     | |         |   | |           |     |     |   |   |   | | |     |       |   |     | |
   | | | +-|---|-|---------------|---------|---------|-+   | | |     +---|-----|-------|-----------|-----+   +---------------------|-------------|-----------|-------|-----+ |     |       |   |     | |
   | | | | |   | |               | |       | |   |   | |   | | |     | | | |   |       |           |               | |         |   | |           |     |     |   |   |   |   |     |       |   |     | |
   | | | | | +-------------------|---------|---------|-|-+ | | |     | | | |   |       |           |               | |         |   | |           |   +-|-----|---|-------------------------+ +-|---+ +-+
   | | | | | | | |               | |       | |   |   | | | | | |     | | | |   |       |           |               | |         |   | |           |   | |     |   |   |   |   |     |         | |   |
   | | | | | | | |         +-----|---------------------|-+ | | |     | +-|-------------|-----+     |               | |         |   | |           |   | |     +-----------|---|---+ |         | |   |
   | | | | | | | |         |     | |       | |   |   | |   | | |     |   | |   |       |     |     |               | |         |   | |           |   | Y         |   |   |   |   | |         | |   |
   | | | | | | | |       +---+ +-----------|-|-------+ |   | | +-----|---|-----|-----------------------------+ +---------------|-----|---------------|-------+   |   |   |   |   | |         | |   |
   | | | | | | | |       | | | | | |       | |   |     |   | |       |   | |   |       |     |     |         | |   | |         |   | |           |   | |     |   |   |   |   |   | |         | |   |
   +-|-|-----|---|-------------|-|-|-------|-|---|-----|---|-------------|-|---+   +---------|-----|-----------------------+   +-----|-----------|---|-------+   +-----+ |   |   | |         | |   |
     | | | | | | |       | | | | | |       | |   |     |   | |       |   | |       |   |     |     |         | |   | |     |       | |           |   | |             | | |   |   | |         | |   |
     | | | | | | |       | | | | | |       | |   |     |   | |       |   | |       |   |     |     |         | |   | |     +-------|-------------|---+ +-------------|-|-|-+ |   | |         | |   |
     | | | | | | |       | | | | | |       | |   |     |   | |       |   | |       |   |     |     |         | |   | |             | |           |                   | | | | |   | |         | |   |
 +-----|-|-----|-|-------|-|-----------------|-------------|-|-----+ | +---+ +-------------------------------------|V----------------|-----------|---------------------------|---------------|-----+
 |   | | | | | | |       | | | | | |       | |   |     |   | |     | | | |   |     |   |     |     |         | |   | |             | |           |                   | | | | |   | |         | |
 |   | | | | | | |     +-----------|-+     | |   |     |   | |     | | | | +-|-----|---------|-----|-----------+   | |           +-|---------------------------------|-|-+ | |   | |       +-------+
 |   | | | | | | |     | | | | | | | |     | |   |     |   | |     | | | | | |     |   |     |     |         |     | |           | | |           |                   | |   | |   | |       | | |   |
 | +-|-|---|-|-|-------|---|---|-----|-----|-|---+   +-----|-|-----|-|-+ | | |     |   |     |     |         | +---+ |           | | |           |                   | |   | |   | |       | | |   |
 | | | | | | | | |     | | | | | | | |     | |       | |   | |     | |   | | |     |   |     |     |         | |     |           | | |           |                   | |   | |   | |       | | |   |
 | +-|-----|---|-|----Q----|-----+ | U +-----|-------|-----|-|-------|---|---+     |   |     |     |         | |     |     +-----|-|-----------------------------------|---------|---------|-----+ |
 |   | | | | | | |     | | | | |   |   |   | |       | |   | |     | |   | |       |   |     |     |         | |     |     |     | | |           |                   | |   | |   | |       | | | | |
 |   | | | | | | |     | | | | | +-------------------|-----|-|-----------|-|-----------------------|---------|-------------|---------------------|-----------+       | |   | |   | |       | | | | |
 |   | | | | | | |     | | | | | | |   |   | |       | |   | |     | |   | |       |   |     |     |         | |     |     |     | | |           |           |       | |   | |   | |       | | | | |
 |   | | | | +-|-------+ | | | +-|-----|---|-|---------|---|-|-----|-+   | |     +-|---|-----|-----------+   | |     |     |     | | |           |           |       | |   | | +-|-|-------+ | | | |
 |   | | | |   | |       | | |   | |   |   | |       | |   | |     |     | |     | |   |     |     |     |   | |     |     |     | | |           |           |       | |   | | | | |         | | | |
 |   | | | |   | |       | | |   | +---------|-------|-----|-----------------------|---------|---------+ |   | |     +-----|-----+ | |           |           |       | +-+ | | | | |         | | | |
 |   | | | |   | |       | | |   |     |   | |       | |   | |     |     | |     | |   |     |     |   | |   | |           |       | |           |           |       |   | | | | | |         | | | |
 |   | | | |   | |       +-|-|-------------|---+     | |   | |     |     | |     | |   |     |     |   | |   | |           |       | |           |           |       |   | | | | | |         | | | |
 |   | | | |   | |         | |   |     |   | | |     | |   | |     |     | |     | |   |     |     |   | |   | |           |       | |           |           |       |   | | | | | |         | | | |
 | +-|-|---|-------------------------+ |   | | |     | |   | |     |     | |     | | +-------|-----|---|-+   | |           |       | |           |           |       |   | | | | | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     | |   | |     |     | |     | | | |     |     |   |     | |           |       | |           |           |       |   | | | | | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     | |   | |     |     | |     | | | |     |     +-----------|-----------|-----------+         |   +-------------------+ | | | | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     | |   | |     |     | |     | | | |     |         |     | |           |       | | |         |   |       |       |     | | | | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     | +---|---+   |     | |     | | | |     |         |     | |           |       | | |         |   | +-----|-------------|---+ | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     |     | | |   |     | |     | | | |     |         |     | |           |       | | |         |   | |     |       |     | |   | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     |     | | |   |     | | +---|-|-|-|---------------------|-|-------------------|-+ |         |   | |     |       |     | |   | |         | | | |
 | | | | | |   | |         | |   |   | |   | | |     |     | | |   |     | | |   | | | |     |         |     | |           |       |   |         |   | |     |       |     | |   | |         | | | |
 | | | | | |   | |         | |   |   | |   | +-|-----|-------------|-----|-|-----------|-----|---+     +-----|---------------------|---|-------+ |   | |     |       |     | |   | |         | | | |
 | | | | | |   | |         | |   |   | |   |   |     |     | | |   |     | | |   | | | |     |   |           | |           |       |   |       | |   | |     |       |     | |   | |         | | | |
 | | | | | | +---+         | |   |   | |   |   |     |     | | |   |     +-|-----+ | | |     |   |           | |           |       |   |       | |   | |     |       |     | |   | |         | | | |
 | | | | | | | |           | |   |   | |   |   |     |     | | |   |       | |     | | |     |   |           | |           |       |   |       | |   | |     |       |     | |   | |         | | | |
 | | +-+ | | +-|-----------|---------|-|---|---|-------------------|-------|-----------|-----|---|-----------|-------------+       |   +-------|-|-----|-----|-------|-----------|-|-----------+ | |
 | |     | |   |           | |   |   | |   |   |     |     | | |   |       | |     | | |     |   |           | |                   |           | |   | |     |       |     | |   | |         |   | |
 | |     | |   |           | |   |   | | +-|---|-----|---------+   +-+     | |     +-|-----------|----B--------|-+                 |           | | +-+ |   +---+     |   +-|-|---+ |         |   | |
 | |     | |   |           | |   |   | | | |   |     |     | |       |     | |       | |     |   |           | | |                 |           | | |   |   | | |     |   | | |     |         |   | |
 | |     | |   +-----------|-----|---|-|-+ |   |     | +-----|-------------|-|---------|-----|---|-----------|-+ |                 |         +-|-+ |   |   | | |     |   | | |     |         |   | |
 | |     | |               | |   |   | |   |   |     | |   | |       |     | |       | |     |   |           |   |                 |         | |   |   |   | | |     |   | | |     |         |   | |
 | |     | |               | |   |   | |   |   | +---|-----|---------|---------------------------|-----------|---|-----------+     |         | |   |   |   | | |     |   | | |     |         |   | |
 | |     | |               | |   |   | |   |   | |   | |   | |       |     | |       | |     |   |           |   |           |     |         | |   |   |   | | |     |   | | |     |         |   | |
 | |     | |               | |   |   | |   +---|-----|---------------+     | |       | |     |   |           |   |         +-|-----|---------|-|-------|---|-|-|-----|---|---+     |         |   | |
 | |     | |               | |   |   | |       | |   | |   | |             | |       | |     |   |           |   |         | |     |         | |   |   |   | | |     |   | |       |         |   | |
 | |     | |               | |   |   | |       | |   | |   | |     +-------|-|-------|-----+ |   +-----------|---|---------|-------|---------|-----|-------|-|-|-----|---|-|-+     |         |   | |
 | |     | |               | |   |   | |       | |   | |   | |     |       | |       | |   | |               |   |         | |     |         | |   |   |   | | |     |   | | |     |         |   | |
 | |     | |               | |   |   | |       | |   | |   | |     |       | |       | |   | |               |   |         | |     +-----------|---|---------|-|-----|-+ | | |     |         |   | |
 | |     | |               | |   |   | |       | |   | |   | |     |       | |       | |   | |               |   |         | |               | |   |   |   | | |     | | | | |     |         |   | |
 | | +---|-----------------|-|-+ |   | |       | +---|-+ +---------|-------------------------|---+           |   |         | |               | |   |   |   | | |     | | | | |     |         |   | |
 | | |   | |               | | | |   | |       |     |   | | |     |       | |       | |   | |   |           |   |         | |               | |   |   |   | | |     | | | | |     |         |   | |
 | | |   | |               | +-+ | +-|---------|---------|-----------------------------|-----|---------------|-------------|-|-----------------+ +-|---|-------|---+ | | | | |     |         |   | |
 | | |   | |               |     | | | |       |     |   | | |     |       | |       | |   | |   |           |   |         | |               |   | |   |   | | |   | | | | | |     |         |   | |
 | | |   | |           +---|-----|---|-----+   | +---|-------|-----|-------|-|---------|---------------------|---|---------|---------------------------|---|-|-|---|---------------|---+ +-+ |   | |
 | | |   | |           |   |     | | | |   |   | |   |   | | |     |       | |       | |   | |   |           |   |         | |               |   | |   |   | | |   | | | | | |     |   | | | |   | |
 | | |   | |     +-----+   +-+   | | | |   |   | |   |   | | |     | +-----|-|-----+ | |   | | +-|-----------|---------------|-------------------------|-----|-|---+ | | | | |     |   | | | |   | |
 | | |   | |     |           |   | | | |   |   | |   |   | | |     | |     | |     | | |   | | | |           |   |         | |               |   | |   |   | | |     | | | | |     |   | | | |   | |
 | +-+   | |     |     +---------|---|-|---+   | |   |   | | |   +-|-------+ |     | | |   | | | |           |   |         | |         +-----+   | |   |   +-|-----------+ | |     |   | | | |   | |
 |       | |     |     |     |   | | | |       | |   |   | | |   | | |       |     | | |   | | | |           |   |         | |         |         | |   |     | |     | |   | |     |   | | | |   | |
 |       | |     |     |     |   | | | |       | |   |   | | |   | +---------------|-|-|---|-----|-----------------------------------------------|-|---|---------------|---|-----+ |   | | | |   | |
 |       | |     |     |     |   | | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         | |         |         | |   |     | |     | |   | |   | |   | | | |   | |
 |       | |     |     |     |   | | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         | +-------------------|-----|-------|---+ | |   | |   | |   | | | |   | |
 |       | |     |     |     |   | | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |           |         | |   |     | |   | | |   | |   | |   | | | |   | |
 |       | |     |     |     |   +-|-|---------|-----------------|-------------------|-|---|-----------------|---|---------|---------+ |         | |   |     | |   | | |   | |   | |   | | | |   | |
 |       | |     |     |     |     | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | |   | | |   | |   | |   | | | |   | |
 |       | |     |     |     |     | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | |   | | |   | |   | |   | | | |   | |
 |       | |     |     |     |     | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | |   | | |   | |   | |   | | | |   | |
 |       | +-----|-----|-------+   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | +---|-|-|---|-------|-+ | | | |   | |
 |       |       |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |
 |       |   +---------|-----|-|---|---|-------|-|-----------|-----------------------|-----|-|---------------|-------------|-----------|---------|-------------------|-------|---|---|-|---|-|---|-----+
 |       |   |   |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |   |
 |       |   |   |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |   |
 |       |   |   |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |   |
 +-+     |   |   |     |     | |   | | |       | +-------+ | |   |   | +-----|-------+ |   | | | |           |   |         |         | +-----------|---|-----------|-|-+ +-+ |   | | | | | | |   | |   |
   |     |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |           | |   |     |     | |   |   |   | | | | | | |   | |   |
 +-----+ |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |           | |   |     |     | |   |   |   | | | | | | |   | |   |
 | |   | |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |           | |   |     |     | |   |   |   | | | | | | |   | |   |
 +-----|-|-------|-------------------|-|-------|-----------|-|---|---------------------|-----|---|-------------------------|---------|---+       | |   |     |     | |   |   |   | | | | +-----------+ |
   |   | |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |   |       | |   |     |     | |   |   |   | | | |   | |   | | | |
   |   | |   |   |     |     | |   | | |       |     |   +-|-|---------|-----------|---|---|---------------------|-------------------+   | +-+   | |   | +-----------|-+ |   |   | | | |   | |   | | | |
   |   | |   |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |   | | | |           |   |         |             | | |   | |   | |   |     | | | |   |   | | | |   | |   | | | |
 +-----|-----|-----------------|-----|---------|-------------|---------------------|---|-+ +-|-|-------------|-------------|-------------|-|-----+ |   | |   |     | | | |   |   | | | |   | |   | | | |
 | |   | |   |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   | |   | | |           |   |         |             | | |     |   | |   |     | | | |   |   | | | |   | |   | | | |
 | +-------+ |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   | +---|---|-----------|---|-------+ |             | | |     |   | |   |     | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |       | |             | | |     |   | |   |     | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |       +---------------|---|-----|-------------+ | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |             | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |   +-|-----|---|-------|---------|---|---|---|-------|-----|-----------|-------------------------------+         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |   | | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |   |         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |   | +---+ | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |   |         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | |
 |     | | | |   |     |   |   | | | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |   |         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | |
 |   +-|-|-------|-----+   |   | | | | |       |     |   | | |   +-----|---+ |     |   |     | | |           |   |         |   |         | +-|-----------|---|---|-|---|-|---------|-|-----|-|-+ | | | |
 |   | | | | |   |         |   | | | | |       |     |   | | |       | |   | |     |   |     | | |           |   |         |   |         |   |     |   | |   |   | | | | |   |   | | | |   | | | | | | |
 |   | | | | |   |         |   | | | | |       |     |   | | |       | |   | |     |   |     | | |           |   |         |   |         |   |     |   | |   |   | | | | |   |   | | | |   | | | | | | |
 |   | | | | |   |         |   | | | | |       |     |   | | |       | |   | |     |   |     | | |           |   |         |   |         |   |     |   | |   |   | | | | |   |   | | | |   | | | | | | |
 |   | | | | |   |         |   | | | | |       |     |   | | |       | +---|-|-+   |   |     | | |           |   |         |   | +-------|---|---------+ |   +---+ | | | | +-----|-+ | |   | | | | | | |
 |   | | | | |   |         |   | | | | |       |     |   | | |       |     | | |   |   |     | | |           |   |         |   | |       |   |     |     |         | | | | | |   |   | |   | | | | | | |
 |   | | | | |   |   +-----|---|-|-|-|---------------|-----|-|-------|-----|-|-|-------|-----|-----------------------------+   | |       |   |     |     |     +-----|-+ | | |   | +-+ |   | | | | | | |
 |   | | | | |   |   |     |   | | | | |       |     |   | | |       |     | | |   |   |     | | |           |   |             | |       |   |     |     |     |   | |   | | |   | |   |   | | | | | | |
 |   | | | | |   |   |     | +---|-|-|-------------------|-|-|-------|-------|---------|-------|-|---------------|-------------|-|---------------------+ |     |   | |   | | +-----|-------+ | | | | | |
 |   | | | | |   |   |     | | | | | | |       |     |   | | |       |     | | |   |   |     | | |           |   |             | |       |   |     |   | |     |   | |   | |     | |   |     | | | | | |
 |   | | | | |   +---------|-----|---|-|-------+     |   | | |   +-+ | +---|-|-+   +---------|-|-|-----------|---+             | |       |   |     |   | |     |   | |   | |     | |   |     | | | | | |
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   | |         |     | | |           |                 | |       |   |     |   | |     |   | |   | |     | |   |     | | | | | |
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   | |     +-------------|-------+   +-------------------+       |   |     |   +-------|---|-|-------+   | |   |     | | | | | |
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   | |     |   |     | | |       |                     |         |   |     |     |     |   | |   | | |   | |   |     | | | | | |
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   +-------|---------|-|-|-+     |                     |         |   |   +-------|---------|-----|---|---|---+ | +-+ | | | | | |
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |     |     |   |     | | | |     |                     |         |   |   | |     |     |   | |   | | |   | | | | | | | | | | | |
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   +-------|---|-----|-|---|---------------------------|-------------|---|-|-----|-----|---|-------|-|---|---+ | | | | | | | | |
 |   | | | | |       |     | | | | | F |             |   | | |   | | | |   | |     |   |     | | | |     |                     |         |   |   | |     |     |   | |   | | |   | |   | | | | | | | | |
 |   | | | | |       |     | | | | | | |             |   +---+   | | | |   | +-----|---|---------------------------------------|---------|---+   +-|-----------|-----+   | +-+   | |   | | | | | | | | |
 |   | | | | |       |     | | | | | | |             |     |     | | | |   |       |   |     A | | |     |                     |         |         |     |     |   |     |       | |   | | | | | | | | |
 +---|-|-+ | |   +---------|---|---|---+             |     |     | | | |   |       |   |     | | | |     |   +-----------------------------------------+ |     |   |     |       | |   | | | | | | | | |
     | |   | |   |   |     | | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | | | | | | | |
     | | +-----------|-+   +-|-|-|-|-|---------------------|-------|-|-|-----------|---|-----|-|---------|---|-----------------|---------|---------------|-----|---|---------------|-----|-|-+ | | | | |
     | | | | |   |   | |     | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | |   | | | | |
 +-------|-|-|-------------+ | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | |   | | | | |
 |   | | | | |   |   | |   | | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | |   | | | | |
 |   | | | | |   |   | |   | | | | | |               |     |     | | | |   |       |   |     | | | +---------------+           |         |         |   | |     |   |     |       | |   | | |   | | | | |
 |   | | | | |   |   | |   | | | | | |               |     |     | | | |   |       |   |     | | |       |   |     |           |         |         |   | |     |   |     |       | |   | | |   | | | | |
 |   | | | | |   |   | |   | | | | | | +-------------|-----------------|-----------|---|-----|-|---------|-------------------------+     |         |   | |     |   |     |       | |   | | |   | | | | |
 |   | | | | |   |   | |   | | | | | | |             |     |     | | | |   |       |   |     | | |       |   |     |           |   |     |         |   | |     |   |     |       | |   | | |   | | | | |
 |   | | | | |   | +-|-+   | | | | | | |             |     |     | | | |   |       |   |     | | |       |   |     |           +---|-------------------|-|-----|---|-------------|-|-----|-----+ | | | |
 |   | | | | |   | | |     | | | | | | |             |     |     | | | |   |       |   |     | | |       |   |     |               |     |         |   | |     |   |     |       | |   | | |     | | | |
 |   | | | | | +-|---|-+   | | | | | | |             |     |     | | | |   |     +-+   |     | | |       |   |     |               |     +---------|-----|-----|---|-----|-------|-------|-|---+ | | | |
 |   | | | | | | | | | |   | | | | | | |             |     |     | | | |   |     |     |     | | |       |   |     |               |               |   | |     |   |     |       | |   | | |   | | | | |
 +---|---+ | | | | | | +-+ | | | | | | |             |     |     | | | |   |     |     |     | | |       |   |     |               |             +-|-----|---+ +-----------+     | |   | | |   | | | | |
     | |   | | | | | |   | | | | | | | |             |     |     | | | |   |     |     |     | | |       |   |     |               |             | |   | |   |     |     | |     | |   | | |   | | | | |
     +---+ +---|-+ | |   | | | | | | | |   +---------|-+   |     | | | |   |     |     |     | | |       |   |     |               |             | |   | |   |     |     | |     | |   | | |   | | | | |
       | |   | |   | |   | | | | | | | |   |         | |   |     | | | |   |     |     |     | | |       |   |     |               |             | |   | |   |     |     | |     | |   | | |   | | | | |
 +-------|---------|---------|-|---|-|-----|-----------|-----------|---|--W------------|---------------------|-----|-------------+ |             | |   | |   |     |     | |     | |   | | |   | | | | |
 |     | |   | |   | |   | | | | | | | |   |         | |   |     | | | |   |     |     |     | | |       |   |     |             | |             | |   | |   |     |     | |     | |   | | |   | | | | |
 |     | |   | +---|-|---|-----|-+ | | | +---+       | |   |     | | +-|---------------------|---|-------|-----------------------------------------|-----|---------|-----|-|-----|-----|---|-------|-+ |
 |     | |   |     | |   | | | |   | | | | | |       | |   |     | |   |   |     |     |     | | |       |   |     |             | |             | |   | |   |     |     | |     | |   | | |   | | |   |
 |     | | +-|-----|---+ | | +-----|---|---|-|---------|---|-----+ | +-+   |     |     |     | | |       |   |     |             | |             | |   | |   |     |     | +-----+ |   | | |   +-|-|-+ |
 |     | | | |     | | | | |   |   | | | | | |       | |   |       | |     |     |     |     | | |       |   |     |             | |             | |   | |   |     |     |         |   | | |     | | | |
 |     | | | |     | | | +---------|-+ | | | |       | |   |       | |     |     |     |     | | |       |   |     |             | |             | |   | |   |     |     |         |   | | |     | | | |
 |     | | | |     | | |   |   |   |   | | | |       | |   |       | |     |     |     |     | | |       |   |     |             | |             | |   | |   |     |     |         |   | | |     | | | |
 |     | | | |     | | |   |   |   |   | | | |       | |   |   +---|-+     |     |     |     | | |       |   |     |             | |       +-----|-----|-|---|-----------+         |   | | |     | | | |
 |     | | | |     | | |   |   |   |   | | | |       | |   |   |   |       |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |     | | | |
 |     | +---|-----|-------|---|---|---|-|-|-+       | |   |   |   |   +---|-----|-----|-----------------|---|-----|-------------|---------------------|-----------|-------------------|---|-----+ | | |
 |     |   | |     | | |   |   |   |   | | |         | |   |   |   |   |   |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |       | | |
 |     |   | |     | | |   |   |   |   | | |         | |   |   |   |   |   |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |       | | |
 |     |   | |     | | |   |   |   |   | | |         | |   |   |   |   |   |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |       | | |
 +-------------------|-|-+ |   |   |   | | |         | |   |   |   |   +---------|---------------|-------|---------|-------------+ +-------+     +-|-+ | |   |     |               |   +-|-|-------|-+ |
       |   | |     | | | | |   |   |   | | |         | |   |   |   |       |     |     |     | | |       |   |     |                               | | | |   |     |               |     | |       |   |
       |   | |   +-|-|-+ | |   |   |   | | |         | |   |   |   +-------|---------------------|-----------|-----|-------------------------------+ | | |   |     |               |     | |       +-+ |
       |   | |   | | |   | |   |   |   | | |         | |   |   |           |     |     |     | | |       |   |     |                                 | | |   |     |               |     | |         | |
       |   | |   +-|-|---------|-----+ | | |         | |   |   |         +-------------|-------|-------------|-----|-----------------------------------|-|---------|-----------------------|-+       | |
       |   | |     | |   | |   |   | | | | |         | |   |   |         | |     |     |     | | |       |   |     |                                 | | |   |     |               |     | | |       | |
       |   | |     | |   | |   |   | | | | |         | |   |   |         | |     |     |     | | |       |   |     |                                 | +-----|-----|-------------------+ | | |       | |
       |   | |     | |   | |   |   | | | | |         | |   |   |         | |     |     |     | | |       |   |     |                                 |   |   |     |               |   | | | |       | |
       |   +-------+ |   | |   +-----|-|-|-|---------------|---|---+   +---------------|-----+ +---------|---+     |                                 |   |   |     |               |   | | | |       | |
       |     |       |   | |       | | | | |         | |   |   |   |   | | |     |     |         |       |         |                                 |   |   |     |               |   | | | |       | |
       |     |       |   | |       | | | +-+         | |   |   +---+ +-----|-----------|---------|-----------------|-------------------------------+ |   |   |     |               |   | | | |       | |
       |     |       |   | |       | | |             | |   |         | | | |     |     |         |       |         |                               | |   |   |     |               |   | | | |       | |
       |     |       |   | |       | | |             | |   |         | | | |     |     |         |       |         |                               | |   |   |     |               | +-|-|-------+   | |
       |     |       |   | |       | | |             | |   |         | | | |     |     |         |       |         |                               | |   |   |     |               | | | | | |   |   | |
       |     |       |   | |       | | |             | |   +-----------|-|-------|-----|---------+       |         |                 +-------------|-----|-------------------------|-|-|-+ | |   |   +-+
       |     |       |   | |       | | |             | |             | | | |     |     |                 |         |                 |             | |   |   |     |               | | |   | |   |
 +-----+ +---+ +-------------------|-----------------+ |           +-|-+ +-------------------------------+         |                 |         +-------------------|---------------|---+   | |   |
 |       |     |     |   | |       | | |               |           | |     |     |     |                           |                 |         |   | |   |   |     |               | |     | |   |
 |       |     +---------|-|-----------|-----------------------------------+     +-----|-----------------------------------------------------------|-|-------------|-----------------|-+   | |   | +---+
 |       |           |   | |       | | |               |           | |                 |                           |                 |         |   | |   |   |     |               | | |   | |   | |   |
 |       |     +-----|---|-------------|-----------------------------------------------|---------------------------|-----------------|---------|---|-+   |   |     +-----------------|-+   | |   | |   |
 |       |     |     |   | |       | | |               |           | |                 |                           |                 |         |   |     |   |                     | |     | |   | |   |
 +-----------+ +-----+   | |       | +-+   +-----------|-----------|-----------------------------------------------+                 |         +---+     |   +-----------------------------|-+   | |   |
         |   |           | |       |       |           |           | |                 |                                             |                   |                         | |     |     | |   |
 +-------|---|-----------+ |       |       |           |           | |                 +-------------------------+                   +-------------------+ +-+                     | |     |     | |   |
 |       |   |             |       |       |           |           | |                                           |                                         | |                     | |     |     | |   |
 |       |   |             |       |       |           +---------------------------------------------------------------------------------------------------+ |                     | |     |     | |   |
 |       |   |             |       |       |                       | |                                           |                                           |                     | |     |     | |   |
 +-------|---+             |       +--------------------------------T|-------------------------------------------|-----------------------------------------------------------------|-|-----|-------+   |
         |                 |               |                       | |                                           |                                           |                     | |     |     |     |
         +-----------------------------------------------------------|---------------------------------------------------------------------------------------|-------------------+ +-+     +-----+     |
                           |               |                       | |                                           |                                           |                   |                     |
                           +---------------+                       +-+                                           +-------------------------------------------+                   +---------------------+

";
